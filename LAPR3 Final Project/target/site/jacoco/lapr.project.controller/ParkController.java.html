<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ParkController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ride-sharing</a> &gt; <a href="index.source.html" class="el_package">lapr.project.controller</a> &gt; <span class="el_source">ParkController.java</span></div><h1>ParkController.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package lapr.project.controller;

import java.sql.SQLException;
import java.util.*;
import javafx.util.Pair;
import lapr.project.data.EmailHandler;
import lapr.project.data.ParkDataHandler;
import lapr.project.data.UserDataHandler;
import lapr.project.model.Capacity;
import lapr.project.model.GeographicalLocation;
import lapr.project.model.Park;
import lapr.project.model.Path;
import lapr.project.model.PointInterest;
import lapr.project.model.Scooter;
import lapr.project.model.User;
import lapr.project.model.Vehicle;

/**
 *
 * @author TiagoRibeiro
 */
public class ParkController {
    
    private final ParkDataHandler parkDataHandler;
    
<span class="fc" id="L31">    public ParkController(ParkDataHandler parkDataHandler) {</span>
<span class="fc" id="L32">        this.parkDataHandler = parkDataHandler;</span>
<span class="fc" id="L33">    }</span>

    /**
     * Allows the Administrator to add a Park to the Database
     *
     * @param parkRef Park's reference
     * @param descripton Park's description
     * @param state Park's State (Wether it's available upon creation or not)
     * @param parkInputVoltage
     * @param parkInputCurrent
     * @param latitude
     * @param longitude
     * @param elevation
     * @param maxCapacityBike total spaces for bicycles
     * @param maxCapacityScooter total spaces for scooters
     * @return the newly created Park
     */
    public Park addPark(String parkRef, String descripton, int state, int parkInputVoltage,
            int parkInputCurrent, double latitude, double longitude, double elevation, int maxCapacityBike, int maxCapacityScooter) throws SQLException {
<span class="fc" id="L52">        GeographicalLocation gl = new GeographicalLocation(latitude, longitude, elevation);</span>
<span class="fc" id="L53">        Park park = new Park(parkRef, descripton, state, parkInputVoltage, parkInputCurrent, gl);</span>
<span class="fc" id="L54">        List&lt;Capacity&gt; capacities = new LinkedList&lt;&gt;();</span>
<span class="fc" id="L55">        capacities.add(new Capacity(Vehicle.BICYCLE_TYPE_ID, maxCapacityBike));</span>
<span class="fc" id="L56">        capacities.add(new Capacity(Vehicle.SCOOTER_TYPE_ID, maxCapacityScooter));</span>
<span class="fc" id="L57">        park.setCapacity(capacities);</span>
        
<span class="fc" id="L59">        park.setIdPoint(parkDataHandler.addPark(park));</span>
        
<span class="fc" id="L61">        return park;</span>
        
    }

    /**
     * @param id park ID
     * @return the park with the ID passed as parameter
     */
    public Park getPark(int id) {
<span class="fc" id="L70">        Park park = null;</span>
        
<span class="fc" id="L72">        park = parkDataHandler.getById(id);</span>
        
<span class="fc" id="L74">        return park;</span>
    }

    /**
     * Allows the administrator to remove a park (this is, alter it's
     * availability state from 1 to 0)
     *
     * @param idPark park to be 'removed'
     * @return true if operation was successful, false if not
     */
    public boolean removePark(int idPark) throws SQLException {
        
<span class="fc" id="L86">        boolean removed = false;</span>
        
<span class="fc" id="L88">        removed = parkDataHandler.removePark(idPark);</span>
        
<span class="fc" id="L90">        return removed;</span>
    }
    
    /**
     * 
     * @param latitude
     * @param longitude
     * @param radius
     * @return
     * @throws ClassNotFoundException
     * @throws SQLException 
     */
    public List&lt;Pair&lt;Double, Park&gt;&gt; getNearestParks(double latitude, double longitude, double radius) throws ClassNotFoundException, SQLException {
<span class="fc" id="L103">        List&lt;Pair&lt;Double, Park&gt;&gt; nearbyParks = new ArrayList&lt;&gt;();</span>
        
<span class="fc" id="L105">        nearbyParks = parkDataHandler.getNearestParks(latitude, longitude, radius);</span>
        
<span class="fc" id="L107">        return nearbyParks;</span>
    }

    /**
     * @return a list of all parks in the system
     * @throws SQLException
     */
    public List&lt;Park&gt; getAllParks() throws SQLException {
        
<span class="fc" id="L116">        List&lt;Park&gt; list = null;</span>
        
<span class="fc" id="L118">        list = parkDataHandler.getAllParks();</span>
<span class="fc" id="L119">        return list;</span>
        
    }

    /**
     * Allows to check a determined park's free spots for the currently loaned
     * vehicle by the user
     *
     * @param parkId park to be acessed in order to check it's availability
     * @param userId user currently loaning a vehicle
     * @return the number of available spots for the type of vehicle being used
     */
    public int checkParkFreeSpots(int parkId, int userId) {
<span class="fc" id="L132">        int spacesAvailable = 0;</span>
        
<span class="fc" id="L134">        spacesAvailable = parkDataHandler.checkParkFreeSpots(parkId, userId);</span>
        
<span class="fc" id="L136">        return spacesAvailable;</span>
    }

    /**
     * Allows the user to park it's vehicle, sending a confirmation e-mail in
     * the case of sucess
     *
     * @param parkId ID of the park where the user will park the loaned vehicle
     * @param idUser user parking the vehicle
     * @return true if operation was successful, false if not
     * @throws SQLException
     */
    public boolean parkVehicle(int parkId, int idUser) throws SQLException {
<span class="nc" id="L149">        boolean actionSucess = false;</span>
<span class="nc" id="L150">        UserController uc = new UserController(new UserDataHandler());</span>
<span class="nc" id="L151">        actionSucess = parkDataHandler.parkVehicle(parkId, idUser);</span>
        
<span class="nc bnc" id="L153" title="All 2 branches missed.">        if (actionSucess == true) {</span>
            try {
<span class="nc" id="L155">                User user = uc.getById(idUser);</span>
<span class="nc" id="L156">                String userEmail = user.getEmail();</span>
<span class="nc" id="L157">                EmailHandler.sendLockedVehicleEmail(userEmail);</span>
<span class="nc" id="L158">            } catch (NullPointerException e) {</span>
<span class="nc" id="L159">                e.printStackTrace();</span>
<span class="nc" id="L160">            }</span>
        }
<span class="nc" id="L162">        return actionSucess;</span>
    }

    /**
     * Add Point of Interest (Actor: Administrator)
     *
     * @param latitude POI latitude
     * @param longitude POI longitude
     * @param elevation POI elevation
     * @param description POI description
     * @return newly created POI
     */
    public PointInterest addPOI(double latitude, double longitude, double elevation, String description) throws SQLException {
        
<span class="fc" id="L176">        GeographicalLocation geo = new GeographicalLocation(latitude, longitude, elevation);</span>
<span class="fc" id="L177">        PointInterest poi = new PointInterest(geo, description);</span>
        
<span class="fc" id="L179">        poi.setIdPoint(parkDataHandler.addPOI(poi));</span>
        
<span class="fc" id="L181">        return poi;</span>
    }

    /**
     * Updates information on a determined Park
     *
     * @param idPark ID of the Park that will have its attributes altered
     * @param description new park description
     * @return true or false on wether the park was properly updated or not
     */
    public boolean updatePark(int idPark, String description) throws SQLException {
        
<span class="fc" id="L193">        boolean updated = false;</span>
        
<span class="fc" id="L195">        updated = parkDataHandler.updatePark(idPark, description);</span>
        
<span class="fc" id="L197">        return updated;</span>
    }
    
    /**
     * 
     * @param latitude
     * @param longitude
     * @return 
     */
    public Park getParkByCoordinates(double latitude, double longitude) {
        
<span class="fc" id="L208">        return parkDataHandler.getParkOfCoordinates(latitude, longitude);</span>
        
    }
    
    /**
     * 
     * @param refPark
     * @return 
     */
    public Park getParkByRefPark(String refPark) {
        
<span class="fc" id="L219">        return parkDataHandler.getParkOfReference(refPark);</span>
        
    }
    
    /**
     * 
     * @param idpark1
     * @return 
     */
    public LinkedList&lt;Pair&lt;Scooter, Double&gt;&gt; calculateTimeNeededToChargeTotalyByPark(int idpark1) {
        
<span class="fc" id="L230">        return parkDataHandler.calculateTimeNeededToChargeTotalyByPark(idpark1);</span>
        
    }

    /**
     * 
     * @param idpark1
     * @param scooterDescription
     * @return 
     */
    public Pair&lt;Scooter, Double&gt; calculateTimeNeededToChargeTotalyByScooter(int idpark1, String scooterDescription) {
        
<span class="fc" id="L242">        return parkDataHandler.calculateTimeNeededToChargeTotalyByScooter(idpark1, scooterDescription);</span>
        
    }

    /**
     * Consults the number of free scooter spots in a given park
     *
     * @param parkId id of the park
     * @return nr of free scooter spots in a given park
     */
    public int checkParkFreeScooterSpots(int parkId) {
<span class="fc" id="L253">        int spacesAvailable = 0;</span>
        
<span class="fc" id="L255">        spacesAvailable = parkDataHandler.checkParkFreeScooterSpots(parkId);</span>
        
<span class="fc" id="L257">        return spacesAvailable;</span>
    }

    /**
     * Consults the number of free bicycle spots in a given park
     *
     * @param parkId
     * @return nr of free bicycle spots in a given park
     */
    public int checkParkFreeBicycleSpots(int parkId) {
<span class="fc" id="L267">        int freeBikeSpots = 0;</span>
        
<span class="fc" id="L269">        freeBikeSpots = parkDataHandler.checkParkFreeBicycleSpots(parkId);</span>
        
<span class="fc" id="L271">        return freeBikeSpots;</span>
    }
    
    /**
     * 
     * @param idPointFrom
     * @param idPointTo
     * @param kinetic
     * @param windDirection
     * @param windSpeed
     * @return
     * @throws SQLException 
     */
    public boolean addPath(int idPointFrom, int idPointTo, double kinetic, float windDirection, float windSpeed) throws SQLException {
<span class="fc" id="L285">        boolean addSuccess = false;</span>
        
<span class="fc" id="L287">        PointInterest from = parkDataHandler.getPoiById(idPointFrom);</span>
<span class="fc" id="L288">        PointInterest to = parkDataHandler.getPoiById(idPointTo);</span>
        
<span class="fc" id="L290">        addSuccess = parkDataHandler.addPath(new Path(from, to, kinetic, windDirection, windSpeed));</span>
        
<span class="fc" id="L292">        return addSuccess;</span>
    }
    
    /**
     * 
     * @param latitude
     * @param longitude
     * @return 
     */
    public PointInterest getPointByCoordinates(double latitude, double longitude) {
<span class="fc" id="L302">        return parkDataHandler.getPointByCoordinates(latitude, longitude);</span>
    }
    
    /**
     * 
     * @param vehicleId
     * @return 
     */
    public Park getParkByVehicleID(int vehicleId) {
<span class="fc" id="L311">        return parkDataHandler.getParkByVehicleID(vehicleId);</span>
    }
    
    /**
     * 
     * @param idPointFrom
     * @param idPointTo
     * @return 
     */
    public Path getPathByIdParks(int idPointFrom, int idPointTo) {
<span class="nc" id="L321">        return parkDataHandler.getPathByIdParks(idPointFrom, idPointTo);</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>