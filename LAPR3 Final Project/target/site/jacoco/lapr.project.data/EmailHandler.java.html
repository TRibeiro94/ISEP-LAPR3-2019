<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>EmailHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ride-sharing</a> &gt; <a href="index.source.html" class="el_package">lapr.project.data</a> &gt; <span class="el_source">EmailHandler.java</span></div><h1>EmailHandler.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package lapr.project.data;


import com.sun.mail.smtp.SMTPTransport;
import javax.activation.DataHandler;
import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.Session;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.util.Date;
import java.util.Properties;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author TiagoRibeiro
 */
<span class="nc" id="L25">public class EmailHandler {</span>
    
<span class="nc" id="L27">    private static final Logger WARNING_LOGGER_EMAIL = Logger.getLogger(EmailHandler.class.getName());</span>
    
    public static void warningError(Exception e) {
<span class="nc" id="L30">        WARNING_LOGGER_EMAIL.log(Level.WARNING, &quot;Error: %s&quot;, e.getMessage());</span>
<span class="nc" id="L31">    }</span>

    private static final String SMTP_SERVER = &quot;smtp.gmail.com&quot;;
    private static final String USERNAME = &quot;lapr3.grupo25@gmail.com&quot;;
    private static final String ACESS = &quot;lapr3_2019_grupo25&quot;;
    private static final String EMAIL_FROM = &quot;lapr3.grupo25@gmail.com&quot;;
    private static final String EMAIL_SUBJECT = &quot;Locked Vehicle Notification&quot;;
    private static final String EMAIL_TEXT = &quot;&lt;h1 align=\&quot;center\&quot;&gt;RIDE SHARING&lt;/h1&gt;&quot;
                                           + &quot;&lt;h4 align=\&quot;center\&quot;&gt;by: Grupo 25&lt;/h4&gt;&quot;
                                           + &quot;&lt;h6 align=\&quot;center\&quot;&gt;Do not reply to this e-mail. &quot;
                                           + &quot;This message was generated automatically.&lt;/h6&gt;&quot;
                                           + &quot;&lt;p align=\&quot;center\&quot;&gt;-------------------------------------------------&lt;/p&gt;&quot;
                                           + &quot;&lt;p align=\&quot;center\&quot;&gt;Hey there!&lt;/p&gt;&quot;
                                           + &quot;&lt;p align=\&quot;center\&quot;&gt;Your vehicle was sucessfuly locked.&lt;/p&gt;&quot;
                                           + &quot;&lt;h3 align=\&quot;center\&quot;&gt; Thank you for travelling with us! You rock! &lt;/h3&gt;&quot;;
    
    public static void sendLockedVehicleEmail(String userEmail){
        
<span class="nc" id="L49">        Properties properties = System.getProperties();</span>
<span class="nc" id="L50">        properties.put(&quot;mail.smtp.host&quot;, SMTP_SERVER);</span>
<span class="nc" id="L51">        properties.put(&quot;mail.smtp.auth&quot;, &quot;true&quot;);</span>
<span class="nc" id="L52">        properties.put(&quot;mail.smtp.ssl.trust&quot;, SMTP_SERVER);</span>
<span class="nc" id="L53">        properties.put(&quot;mail.smtp.starttls.enable&quot;, &quot;true&quot;);</span>
<span class="nc" id="L54">        properties.put(&quot;mail.smtp.port&quot;, &quot;587&quot;);                               </span>
        
<span class="nc" id="L56">        Session session = Session.getInstance(properties, null);</span>
<span class="nc" id="L57">        Message msg = new MimeMessage(session);</span>
        
        try {
<span class="nc" id="L60">            msg.setFrom(new InternetAddress(EMAIL_FROM));                                            </span>
<span class="nc" id="L61">            msg.setRecipients(Message.RecipientType.TO, InternetAddress.parse(userEmail, false));     </span>
<span class="nc" id="L62">            msg.setSubject(EMAIL_SUBJECT);                                                          </span>
<span class="nc" id="L63">            msg.setSentDate(new Date());</span>
<span class="nc" id="L64">            msg.setDataHandler(new DataHandler(new HTMLDataSource(EMAIL_TEXT)));</span>
            
            // Get SMTPTransport
<span class="nc" id="L67">            SMTPTransport transport = (SMTPTransport) session.getTransport(&quot;smtp&quot;); </span>
            // Establish connection
<span class="nc" id="L69">            transport.connect(SMTP_SERVER, USERNAME, ACESS);   </span>
            // Send
<span class="nc" id="L71">            transport.sendMessage(msg, msg.getAllRecipients());</span>
<span class="nc" id="L72">            WARNING_LOGGER_EMAIL.log(Level.INFO, &quot;Response: %s&quot;, transport.getLastServerResponse());</span>
<span class="nc" id="L73">            transport.close();</span>
            
<span class="nc" id="L75">        } catch (MessagingException e) {</span>
<span class="nc" id="L76">            warningError(e);                                        </span>
<span class="nc" id="L77">        } </span>
<span class="nc" id="L78">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>