<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RentalDataHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ride-sharing</a> &gt; <a href="index.source.html" class="el_package">lapr.project.data</a> &gt; <span class="el_source">RentalDataHandler.java</span></div><h1>RentalDataHandler.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package lapr.project.data;

import java.sql.CallableStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javafx.util.Pair;
import lapr.project.model.Graph;
import lapr.project.model.PointInterest;
import lapr.project.model.User;
import lapr.project.model.Rental;
import lapr.project.model.Path;
import lapr.project.utils.PhysicsAlgorithms;
import lapr.project.model.Park;
import lapr.project.model.Scooter;
import lapr.project.model.Vehicle;
import lapr.project.model.AdjacencyMatrix;
import lapr.project.model.Bicycle;
import lapr.project.model.GraphAlgorithms;
import lapr.project.model.MatrixAlgorithms;
import oracle.jdbc.OracleTypes;

/**
 *
 * @author Bernardo Carvalho
 */
public class RentalDataHandler {

<span class="fc" id="L41">    private static final Logger WARNING_LOGGER = Logger.getLogger(Rental.class.getName());</span>

    private final DataHandler dataHandler;

<span class="nc" id="L45">    public RentalDataHandler() {</span>
<span class="nc" id="L46">        dataHandler = DataHandler.getInstance();</span>
<span class="nc" id="L47">    }</span>

    public static void warningError() {
<span class="nc" id="L50">        WARNING_LOGGER.log(Level.WARNING, &quot;Error on reading Database.&quot;);</span>
<span class="nc" id="L51">    }</span>

    /**
     * Method used to create an adjacency matrix of points of interest
     *
     * @param graph Graph that contains the points of interest that we be used
     * to create the adjacency matrix
     * @return adjacency matrix of points of interest
     */
    public AdjacencyMatrix generateAdjacencyMatrix(Graph&lt;PointInterest, Integer&gt; graph) {

<span class="nc" id="L62">        AdjacencyMatrix matrizAdjacencias = new AdjacencyMatrix(graph.numVertices());</span>

<span class="nc bnc" id="L64" title="All 2 branches missed.">        for (PointInterest p1 : graph.vertices()) {</span>
<span class="nc" id="L65">            matrizAdjacencias.insertVertex(p1);</span>
<span class="nc" id="L66">        }</span>

<span class="nc bnc" id="L68" title="All 2 branches missed.">        for (PointInterest p1 : graph.vertices()) {</span>
<span class="nc bnc" id="L69" title="All 2 branches missed.">            for (PointInterest p2 : graph.vertices()) {</span>
<span class="nc bnc" id="L70" title="All 4 branches missed.">                if (graph.getEdge(p1, p2) != null &amp;&amp; !p1.equals(p2)) {</span>
<span class="nc" id="L71">                    matrizAdjacencias.insertEdge(p1, p2, graph.getEdge(p1, p2).getWeight());</span>
                }
<span class="nc" id="L73">            }</span>
<span class="nc" id="L74">        }</span>
<span class="nc" id="L75">        matrizAdjacencias = MatrixAlgorithms.transitiveClosure(matrizAdjacencias, null);</span>
<span class="nc" id="L76">        return matrizAdjacencias;</span>
    }

    /**
     *
     * @return 
     */
    public Graph&lt;PointInterest, Integer&gt; generateDistanceGraph(){

<span class="nc" id="L85">        Graph&lt;PointInterest, Integer&gt; routesGraph = new Graph&lt;&gt;(true);</span>

<span class="nc" id="L87">        List&lt;PointInterest&gt; poiList = new ParkDataHandler().getAllPointsOfInterest();</span>
<span class="nc" id="L88">        List&lt;Path&gt; pathsList = new ParkDataHandler().getAllPaths();</span>

<span class="nc bnc" id="L90" title="All 2 branches missed.">        for (PointInterest poi : poiList) {</span>
<span class="nc" id="L91">            routesGraph.insertVertex(poi);</span>
<span class="nc" id="L92">        }</span>

<span class="nc bnc" id="L94" title="All 2 branches missed.">        for (Path path : pathsList) {</span>
<span class="nc" id="L95">            double distance = new PhysicsAlgorithms().calculateDistanceWithElevation(path.getPointFrom().getGeoLocation().getLatitude(),</span>
<span class="nc" id="L96">                    path.getPointTo().getGeoLocation().getLatitude(), path.getPointFrom().getGeoLocation().getLongitude(),</span>
<span class="nc" id="L97">                    path.getPointTo().getGeoLocation().getLongitude(), path.getPointFrom().getGeoLocation().getElevation(),</span>
<span class="nc" id="L98">                    path.getPointTo().getGeoLocation().getElevation());</span>

<span class="nc" id="L100">            routesGraph.insertEdge(path.getPointFrom(), path.getPointTo(), 1, distance);</span>
<span class="nc" id="L101">        }</span>

<span class="nc" id="L103">        return routesGraph;</span>
    }

    /**
     *
     * @param userId
     * @param vehicle
     * @return
     */
    public Graph&lt;PointInterest, Integer&gt; generateEnergyGraph(int userId, Vehicle vehicle){

<span class="nc" id="L114">        Graph&lt;PointInterest, Integer&gt; efficientRoutesGraph = new Graph&lt;&gt;(true);</span>

<span class="nc" id="L116">        List&lt;PointInterest&gt; poiList = new ParkDataHandler().getAllPointsOfInterest();</span>
<span class="nc" id="L117">        List&lt;Path&gt; pathsList = new ParkDataHandler().getAllPaths();</span>
<span class="nc" id="L118">        User user = new UserDataHandler().getById(userId);</span>

<span class="nc bnc" id="L120" title="All 2 branches missed.">        for (PointInterest poi : poiList) {</span>
<span class="nc" id="L121">            efficientRoutesGraph.insertVertex(poi);</span>
<span class="nc" id="L122">        }</span>

<span class="nc bnc" id="L124" title="All 2 branches missed.">        for (Path path : pathsList) {</span>
<span class="nc bnc" id="L125" title="All 2 branches missed.">            if(vehicle instanceof Bicycle){</span>
<span class="nc" id="L126">                double energy = new PhysicsAlgorithms().calculateCalories(vehicle.getWeight(), user.getWeight(),</span>
<span class="nc" id="L127">                        path.getKineticCoefficient(), vehicle.getFrontalArea(), user.getCyclingAverageSpeed(),</span>
<span class="nc" id="L128">                        vehicle.getAerodynamicCoefficient(), path.getWindSpeed(), path.getWindDirection(),</span>
<span class="nc" id="L129">                        path.getPointFrom().getGeoLocation().getElevation(), path.getPointTo().getGeoLocation().getElevation(),</span>
<span class="nc" id="L130">                        path.getPointFrom().getGeoLocation().getLatitude(), path.getPointTo().getGeoLocation().getLatitude(),</span>
<span class="nc" id="L131">                        path.getPointFrom().getGeoLocation().getLongitude(), path.getPointTo().getGeoLocation().getLongitude());</span>

<span class="nc" id="L133">                efficientRoutesGraph.insertEdge(path.getPointFrom(), path.getPointTo(), 1, energy);</span>
<span class="nc" id="L134">            }</span>
<span class="nc bnc" id="L135" title="All 2 branches missed.">            else if((vehicle instanceof Scooter)){</span>
<span class="nc" id="L136">                double energy = new PhysicsAlgorithms().calculateEnergySpentBetweenPoints(vehicle.getWeight(), user.getWeight(),</span>
<span class="nc" id="L137">                        path.getKineticCoefficient(), vehicle.getFrontalArea(),</span>
<span class="nc" id="L138">                        vehicle.getAerodynamicCoefficient(), path.getWindSpeed(), path.getWindDirection(),</span>
<span class="nc" id="L139">                        path.getPointFrom().getGeoLocation().getElevation(), path.getPointTo().getGeoLocation().getElevation(),</span>
<span class="nc" id="L140">                        path.getPointFrom().getGeoLocation().getLatitude(), path.getPointTo().getGeoLocation().getLatitude(),</span>
<span class="nc" id="L141">                        path.getPointFrom().getGeoLocation().getLongitude(), path.getPointTo().getGeoLocation().getLongitude());</span>

<span class="nc" id="L143">                efficientRoutesGraph.insertEdge(path.getPointFrom(), path.getPointTo(), 1, energy);</span>
            }
<span class="nc" id="L145">        }</span>

<span class="nc" id="L147">        return efficientRoutesGraph;</span>
    }
    
    /**
     * 
     * @param paths
     * @param destiny
     * @param routesGraph
     * @param shortestPaths
     * @param numPois
     * @return 
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; getShortestPaths(List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; paths, PointInterest destiny, Graph&lt;PointInterest, Integer&gt; routesGraph, List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestPaths, int numPois, int numIterations){
<span class="nc bnc" id="L160" title="All 2 branches missed.">        if(numIterations &lt; 0){</span>
<span class="nc bnc" id="L161" title="All 2 branches missed.">            for (Pair&lt;Double, List&lt;PointInterest&gt;&gt; pair : paths) {</span>
<span class="nc bnc" id="L162" title="All 4 branches missed.">                if(pair.getValue().size() == numPois+2 &amp;&amp; pair.getValue().get(pair.getValue().size()-1).equals(destiny)){</span>
<span class="nc bnc" id="L163" title="All 4 branches missed.">                    if(!shortestPaths.isEmpty() &amp;&amp; pair.getKey() &lt; shortestPaths.get(shortestPaths.size()-1).getKey()){</span>
<span class="nc" id="L164">                        shortestPaths.clear();</span>
<span class="nc" id="L165">                        shortestPaths.add(pair);</span>
                    }
<span class="nc bnc" id="L167" title="All 4 branches missed.">                    else if(!shortestPaths.isEmpty() &amp;&amp; pair.getKey() == shortestPaths.get(shortestPaths.size()-1).getKey()){</span>
<span class="nc" id="L168">                        shortestPaths.add(pair);</span>
                    }
<span class="nc bnc" id="L170" title="All 2 branches missed.">                    else if(shortestPaths.isEmpty()){</span>
<span class="nc" id="L171">                        shortestPaths.add(pair);</span>
                    }
                }
<span class="nc" id="L174">            }</span>
<span class="nc" id="L175">            return shortestPaths;</span>
        }
<span class="nc" id="L177">        List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; newPaths = new ArrayList();</span>
<span class="nc bnc" id="L178" title="All 2 branches missed.">        for (Pair&lt;Double, List&lt;PointInterest&gt;&gt; pa : paths) {</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">            for(PointInterest p : routesGraph.adjVertices(pa.getValue().get(pa.getValue().size()-1))){</span>
<span class="nc" id="L180">                List&lt;PointInterest&gt; path = new ArrayList&lt;&gt;(pa.getValue());</span>
<span class="nc" id="L181">                path.add(p);</span>
<span class="nc" id="L182">                Double weight = pa.getKey() + routesGraph.getEdge(pa.getValue().get(pa.getValue().size()-1), p).getWeight();</span>
<span class="nc" id="L183">                Pair&lt;Double, List&lt;PointInterest&gt;&gt; pair = new Pair&lt;&gt;(weight, path);</span>
<span class="nc bnc" id="L184" title="All 2 branches missed.">                if(!paths.contains(pair)){</span>
<span class="nc" id="L185">                    newPaths.add(pair);</span>
                }
<span class="nc" id="L187">            }</span>
<span class="nc" id="L188">        }</span>
<span class="nc" id="L189">        paths.addAll(newPaths);</span>
<span class="nc" id="L190">        return getShortestPaths(paths, destiny, routesGraph, shortestPaths, numPois, numIterations-1);</span>
    }
    
    /**
     * 
     * @param paths
     * @param destiny
     * @param routesGraph
     * @param shortestPaths
     * @param numPois
     * @return 
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; getMostEfficientPaths(List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; paths, PointInterest destiny, Graph&lt;PointInterest, Integer&gt; routesGraph, List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestPaths, int numPois){
<span class="nc bnc" id="L203" title="All 2 branches missed.">        if(numPois &lt; 0){</span>
<span class="nc" id="L204">            return shortestPaths;</span>
        }
<span class="nc" id="L206">        List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; newPaths = new ArrayList();</span>
<span class="nc bnc" id="L207" title="All 2 branches missed.">        for(Pair&lt;Double, List&lt;PointInterest&gt;&gt; pa : paths){</span>
<span class="nc bnc" id="L208" title="All 2 branches missed.">            for(PointInterest p : routesGraph.adjVertices(pa.getValue().get(pa.getValue().size()-1))){</span>
<span class="nc" id="L209">                List&lt;PointInterest&gt; path = new ArrayList&lt;&gt;(pa.getValue());</span>
<span class="nc" id="L210">                path.add(p);</span>
<span class="nc" id="L211">                Double weight = pa.getKey() + routesGraph.getEdge(pa.getValue().get(pa.getValue().size()-1), p).getWeight();</span>
<span class="nc" id="L212">                Pair&lt;Double, List&lt;PointInterest&gt;&gt; pair = new Pair&lt;&gt;(weight, path);</span>
<span class="nc bnc" id="L213" title="All 4 branches missed.">                if(p.equals(destiny) &amp;&amp; shortestPaths.isEmpty()){</span>
<span class="nc" id="L214">                    shortestPaths.add(pair);</span>
                }
<span class="nc bnc" id="L216" title="All 6 branches missed.">                else if(p.equals(destiny) &amp;&amp; !shortestPaths.contains(pair) &amp;&amp; !shortestPaths.isEmpty() </span>
<span class="nc bnc" id="L217" title="All 2 branches missed.">                        &amp;&amp; (double)pair.getKey() == shortestPaths.get(0).getKey()){</span>
<span class="nc" id="L218">                    shortestPaths.add(pair);</span>
                }
<span class="nc bnc" id="L220" title="All 6 branches missed.">                else if(p.equals(destiny) &amp;&amp; !shortestPaths.contains(pair) &amp;&amp; !shortestPaths.isEmpty() </span>
<span class="nc bnc" id="L221" title="All 2 branches missed.">                        &amp;&amp; (double)pair.getKey() &lt; shortestPaths.get(0).getKey()){</span>
<span class="nc" id="L222">                    shortestPaths.clear();</span>
<span class="nc" id="L223">                    shortestPaths.add(pair);</span>
                }
<span class="nc bnc" id="L225" title="All 2 branches missed.">                else if(!paths.contains(pair)){</span>
<span class="nc" id="L226">                    newPaths.add(pair);</span>
                }
<span class="nc" id="L228">            }</span>
<span class="nc" id="L229">        }</span>
<span class="nc" id="L230">        paths.addAll(newPaths);</span>
<span class="nc" id="L231">        return getMostEfficientPaths(paths, destiny, routesGraph, shortestPaths, numPois-1);</span>
    }

    /**
     *
     * @param point1
     * @param point2
     * @param numPois
     * @return
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestRoute(PointInterest point1, PointInterest point2, int numPois) {

<span class="nc" id="L243">        Graph&lt;PointInterest, Integer&gt; routesGraph = this.generateDistanceGraph();</span>

<span class="nc bnc" id="L245" title="All 4 branches missed.">        if (!routesGraph.validVertex(point1) || !routesGraph.validVertex(point2)) {</span>
<span class="nc" id="L246">            return new ArrayList&lt;&gt;();</span>
        } else {
<span class="nc" id="L248">            List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestPaths = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L249">            List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; paths = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L250">            List&lt;PointInterest&gt; initialPath = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L251">            initialPath.add(point1);</span>
<span class="nc" id="L252">            paths.add(new Pair(0.0, initialPath));</span>
<span class="nc" id="L253">            shortestPaths = this.getShortestPaths(paths, point2, routesGraph, shortestPaths, numPois, numPois);</span>
            
<span class="nc" id="L255">            Collections.sort(shortestPaths, (final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p1, final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p2) -&gt; {</span>
<span class="nc" id="L256">                double inclination1 = Math.abs(p1.getValue().get(p1.getValue().size()-1).getGeoLocation().getElevation() - p1.getValue().get(0).getGeoLocation().getElevation());</span>
                
<span class="nc" id="L258">                double inclination2 = Math.abs(p2.getValue().get(p2.getValue().size()-1).getGeoLocation().getElevation() - p2.getValue().get(0).getGeoLocation().getElevation());</span>
                
<span class="nc bnc" id="L260" title="All 2 branches missed.">                if (p1.getValue().size() &gt; p2.getValue().size()) {</span>
<span class="nc" id="L261">                    return 1;</span>
<span class="nc bnc" id="L262" title="All 2 branches missed.">                } else if (p1.getValue().size() &lt; p2.getValue().size()) {</span>
<span class="nc" id="L263">                    return -1;</span>
<span class="nc bnc" id="L264" title="All 2 branches missed.">                } else if (inclination1 &gt; inclination2) {</span>
<span class="nc" id="L265">                    return 1;</span>
<span class="nc bnc" id="L266" title="All 2 branches missed.">                } else if (inclination1 &lt; inclination2) {</span>
<span class="nc" id="L267">                    return -1;</span>
                }
<span class="nc" id="L269">                return 0;</span>
            });
            
<span class="nc" id="L272">            List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestPathsCopy = new ArrayList&lt;&gt;(shortestPaths);</span>
            
<span class="nc bnc" id="L274" title="All 2 branches missed.">            for (Pair&lt;Double, List&lt;PointInterest&gt;&gt; shortestPath : shortestPathsCopy) {</span>
<span class="nc bnc" id="L275" title="All 2 branches missed.">                if(shortestPath.getValue().size() != numPois + 2){</span>
<span class="nc" id="L276">                    shortestPaths.remove(shortestPath);</span>
                }
<span class="nc" id="L278">            }</span>
            
<span class="nc" id="L280">            return shortestPaths;</span>
        }
    }

    /**
     *
     * @param userId
     * @param vehicle
     * @param point1
     * @param point2
     * @return
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; mostEnergeticallyEfficientRoute(int userId, Vehicle vehicle, PointInterest point1, PointInterest point2){

<span class="nc" id="L294">        Graph&lt;PointInterest, Integer&gt; routesGraph = this.generateEnergyGraph(userId, vehicle);</span>

<span class="nc bnc" id="L296" title="All 4 branches missed.">        if (!routesGraph.validVertex(point1) || !routesGraph.validVertex(point2)) {</span>
<span class="nc" id="L297">            return new ArrayList&lt;&gt;();</span>
        } else {
<span class="nc" id="L299">            List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestPaths = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L300">            List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; paths = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L301">            List&lt;PointInterest&gt; initialPath = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L302">            initialPath.add(point1);</span>
<span class="nc" id="L303">            paths.add(new Pair(0.0, initialPath));</span>
<span class="nc" id="L304">            shortestPaths = this.getMostEfficientPaths(paths, point2, routesGraph, shortestPaths, 2);</span>
            
<span class="nc" id="L306">            Collections.sort(shortestPaths, (final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p1, final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p2) -&gt; {</span>
<span class="nc" id="L307">                double inclination1 = Math.abs(p1.getValue().get(p1.getValue().size()-1).getGeoLocation().getElevation() - p1.getValue().get(0).getGeoLocation().getElevation());</span>
                
<span class="nc" id="L309">                double inclination2 = Math.abs(p2.getValue().get(p2.getValue().size()-1).getGeoLocation().getElevation() - p2.getValue().get(0).getGeoLocation().getElevation());</span>
                
<span class="nc bnc" id="L311" title="All 2 branches missed.">                if (p1.getValue().size() &gt; p2.getValue().size()) {</span>
<span class="nc" id="L312">                    return 1;</span>
<span class="nc bnc" id="L313" title="All 2 branches missed.">                } else if (p1.getValue().size() &lt; p2.getValue().size()) {</span>
<span class="nc" id="L314">                    return -1;</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">                } else if (inclination1 &gt; inclination2) {</span>
<span class="nc" id="L316">                    return 1;</span>
<span class="nc bnc" id="L317" title="All 2 branches missed.">                } else if (inclination1 &lt; inclination2) {</span>
<span class="nc" id="L318">                    return -1;</span>
                }
<span class="nc" id="L320">                return 0;</span>
            });
            
<span class="nc" id="L323">            return shortestPaths;</span>
        }

    }

    /**
     * Generating permutations using Heap Algorithm
     *
     * @param poisList
     * @param size
     * @param pathsPassingThroughPoints
     * @param point1
     * @param point2
     * @param routesGraph
     * @param routesMatrix
     * @return
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; pathsPermutationAlgorithm(List&lt;PointInterest&gt; poisList, int size, List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; pathsPassingThroughPoints, PointInterest point1, PointInterest point2, Graph&lt;PointInterest, Integer&gt; routesGraph, AdjacencyMatrix routesMatrix) {

<span class="nc bnc" id="L342" title="All 2 branches missed.">        if (size == 1) {</span>
<span class="nc" id="L343">            List&lt;PointInterest&gt; poisListCopy = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L344">            LinkedList&lt;PointInterest&gt; shortPath = new LinkedList&lt;&gt;();</span>
<span class="nc" id="L345">            GraphAlgorithms.shortestPath(routesGraph, point1, poisList.get(0), shortPath);</span>
<span class="nc" id="L346">            poisListCopy.addAll(shortPath);</span>
<span class="nc" id="L347">            shortPath.clear();</span>
<span class="nc bnc" id="L348" title="All 2 branches missed.">            for (int k = 0; k &lt; poisList.size() - 1; k++) {</span>
<span class="nc" id="L349">                GraphAlgorithms.shortestPath(routesGraph, poisList.get(k), poisList.get(k+1), shortPath);</span>
<span class="nc" id="L350">                shortPath.remove(shortPath.get(0));</span>
<span class="nc" id="L351">                poisListCopy.addAll(shortPath);</span>
<span class="nc" id="L352">                shortPath.clear();</span>
            }
<span class="nc" id="L354">            GraphAlgorithms.shortestPath(routesGraph, poisList.get(poisList.size()-1), point2, shortPath);</span>
<span class="nc" id="L355">            shortPath.remove(shortPath.get(0));</span>
<span class="nc" id="L356">            poisListCopy.addAll(shortPath);</span>
<span class="nc" id="L357">            double distance = 0;</span>
<span class="nc bnc" id="L358" title="All 2 branches missed.">            for (int j = 0; j &lt; poisListCopy.size() - 1; j++) {</span>
<span class="nc" id="L359">                distance += routesMatrix.getEdge(poisListCopy.get(j), poisListCopy.get(j + 1));</span>
            }
<span class="nc" id="L361">            Pair pair = new Pair(distance, poisListCopy);</span>
<span class="nc bnc" id="L362" title="All 2 branches missed.">            if(pathsPassingThroughPoints.isEmpty()){</span>
<span class="nc" id="L363">                pathsPassingThroughPoints.add(pair);</span>
            }
<span class="nc bnc" id="L365" title="All 2 branches missed.">            else if(distance &lt; pathsPassingThroughPoints.get(0).getKey()){</span>
<span class="nc" id="L366">                pathsPassingThroughPoints.clear();</span>
<span class="nc" id="L367">                pathsPassingThroughPoints.add(pair);</span>
            }
<span class="nc bnc" id="L369" title="All 2 branches missed.">            else if(distance == pathsPassingThroughPoints.get(0).getKey()){</span>
<span class="nc" id="L370">                pathsPassingThroughPoints.add(pair);</span>
            }
        }

<span class="nc bnc" id="L374" title="All 2 branches missed.">        for (int i = 0; i &lt; size; i++) {</span>

<span class="nc" id="L376">            pathsPermutationAlgorithm(poisList, size - 1, pathsPassingThroughPoints, point1, point2, routesGraph, routesMatrix);</span>

<span class="nc bnc" id="L378" title="All 2 branches missed.">            if (size % 2 == 1) {</span>
<span class="nc" id="L379">                PointInterest temp = poisList.get(0);</span>
<span class="nc" id="L380">                poisList.set(0, poisList.get(size - 1));</span>
<span class="nc" id="L381">                poisList.set(size - 1, temp);</span>
<span class="nc" id="L382">            } else {</span>
<span class="nc" id="L383">                PointInterest temp2 = poisList.get(i);</span>
<span class="nc" id="L384">                poisList.set(i, poisList.get(size - 1));</span>
<span class="nc" id="L385">                poisList.set(size - 1, temp2);</span>
            }
        }

<span class="nc" id="L389">        return pathsPassingThroughPoints;</span>
    }

    /**
     *
     * @param point1
     * @param point2
     * @param poisList
     * @return
     * @throws SQLException
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; shortestRoutePassingThroughPoints(PointInterest point1, PointInterest point2, ArrayList&lt;PointInterest&gt; poisList) throws SQLException {

<span class="nc" id="L402">        Graph&lt;PointInterest, Integer&gt; routesGraph = this.generateDistanceGraph();</span>
<span class="nc" id="L403">        AdjacencyMatrix routesMatrix = this.generateAdjacencyMatrix(routesGraph);</span>
<span class="nc" id="L404">        List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; pathsPassingThroughPoints = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L406" title="All 4 branches missed.">        if (!routesGraph.validVertex(point1) || !routesGraph.validVertex(point2)) {</span>
<span class="nc" id="L407">            return new ArrayList&lt;&gt;();</span>
        } else {
<span class="nc bnc" id="L409" title="All 4 branches missed.">            if(!poisList.isEmpty() || poisList != null){</span>
<span class="nc" id="L410">                pathsPassingThroughPoints = this.pathsPermutationAlgorithm(poisList, poisList.size(), pathsPassingThroughPoints, point1, point2, routesGraph, routesMatrix);</span>
            }
            else{
<span class="nc" id="L413">                return new ArrayList&lt;&gt;();</span>
            }
            
<span class="nc" id="L416">            Collections.sort(pathsPassingThroughPoints, (final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p1, final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p2) -&gt; {</span>
<span class="nc" id="L417">                double inclination1 = Math.abs(p1.getValue().get(p1.getValue().size()-1).getGeoLocation().getElevation() - p1.getValue().get(0).getGeoLocation().getElevation());</span>
                
<span class="nc" id="L419">                double inclination2 = Math.abs(p2.getValue().get(p2.getValue().size()-1).getGeoLocation().getElevation() - p2.getValue().get(0).getGeoLocation().getElevation());</span>
                
<span class="nc bnc" id="L421" title="All 2 branches missed.">                if (p1.getValue().size() &gt; p2.getValue().size()) {</span>
<span class="nc" id="L422">                    return 1;</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">                } else if (p1.getValue().size() &lt; p2.getValue().size()) {</span>
<span class="nc" id="L424">                    return -1;</span>
<span class="nc bnc" id="L425" title="All 2 branches missed.">                } else if (inclination1 &gt; inclination2) {</span>
<span class="nc" id="L426">                    return 1;</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">                } else if (inclination1 &lt; inclination2) {</span>
<span class="nc" id="L428">                    return -1;</span>
                }
<span class="nc" id="L430">                return 0;</span>
            });

<span class="nc" id="L433">            return pathsPassingThroughPoints;</span>
        }

    }

    /**
     *
     * @param userId
     * @param vehicle
     * @param point1
     * @param point2
     * @param poisList
     * @param numRoutes
     * @param ascendingOrder
     * @param sortingCriteria
     * @return
     * @throws SQLException
     */
    public List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; mostEfficientRoutePassingThroughPoints(int userId, Vehicle vehicle, PointInterest point1, PointInterest point2, ArrayList&lt;PointInterest&gt; poisList, int numRoutes, boolean ascendingOrder, String sortingCriteria){
<span class="nc" id="L452">        Graph&lt;PointInterest, Integer&gt; routesGraph = this.generateEnergyGraph(userId, vehicle);</span>
<span class="nc" id="L453">        AdjacencyMatrix routesMatrix = this.generateAdjacencyMatrix(routesGraph);</span>
<span class="nc" id="L454">        List&lt;Pair&lt;Double, List&lt;PointInterest&gt;&gt;&gt; pathsPassingThroughPoints = new ArrayList&lt;&gt;();</span>

<span class="nc bnc" id="L456" title="All 4 branches missed.">        if (!routesGraph.validVertex(point1) || !routesGraph.validVertex(point2)) {</span>
<span class="nc" id="L457">            return new ArrayList&lt;&gt;();</span>
        } else {
<span class="nc bnc" id="L459" title="All 4 branches missed.">            if(!poisList.isEmpty() || poisList != null){</span>
<span class="nc" id="L460">                pathsPassingThroughPoints = this.pathsPermutationAlgorithm(poisList, poisList.size(), pathsPassingThroughPoints, point1, point2, routesGraph, routesMatrix);</span>
            }
            else{
<span class="nc" id="L463">                return new ArrayList&lt;&gt;();</span>
            }
<span class="nc bnc" id="L465" title="All 2 branches missed.">            if(sortingCriteria.equalsIgnoreCase(&quot;energy&quot;)){</span>
<span class="nc" id="L466">                Collections.sort(pathsPassingThroughPoints, (final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p1, final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p2) -&gt; {</span>
<span class="nc bnc" id="L467" title="All 2 branches missed.">                    if (p1.getKey() &gt; p2.getKey()) {</span>
<span class="nc" id="L468">                        return 1;</span>
<span class="nc bnc" id="L469" title="All 2 branches missed.">                    } else if (p1.getKey() &lt; p2.getKey()) {</span>
<span class="nc" id="L470">                        return -1;</span>
                    }
<span class="nc" id="L472">                    return 0;</span>
                });
            }
<span class="nc bnc" id="L475" title="All 2 branches missed.">            else if(sortingCriteria.equalsIgnoreCase(&quot;shortest_distance&quot;)){</span>
<span class="nc" id="L476">                Collections.sort(pathsPassingThroughPoints, (final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p1, final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p2) -&gt; {</span>
<span class="nc" id="L477">                    double distance1 = 0;</span>
<span class="nc bnc" id="L478" title="All 2 branches missed.">                    for(int i = 0; i &lt; p1.getValue().size() - 1; i++){</span>
<span class="nc" id="L479">                        distance1 += new PhysicsAlgorithms().calculateDistanceWithElevation(p1.getValue().get(i).getGeoLocation().getLatitude(),</span>
<span class="nc" id="L480">                    p1.getValue().get(i+1).getGeoLocation().getLatitude(), p1.getValue().get(i).getGeoLocation().getLongitude(),</span>
<span class="nc" id="L481">                    p1.getValue().get(i+1).getGeoLocation().getLongitude(), p1.getValue().get(i).getGeoLocation().getElevation(),</span>
<span class="nc" id="L482">                    p1.getValue().get(i+1).getGeoLocation().getElevation());</span>
                    }
                    
<span class="nc" id="L485">                    double distance2 = 0;</span>
<span class="nc bnc" id="L486" title="All 2 branches missed.">                    for(int i = 0; i &lt; p2.getValue().size() - 1; i++){</span>
<span class="nc" id="L487">                        distance2 += new PhysicsAlgorithms().calculateDistanceWithElevation(p2.getValue().get(i).getGeoLocation().getLatitude(),</span>
<span class="nc" id="L488">                    p2.getValue().get(i+1).getGeoLocation().getLatitude(), p2.getValue().get(i).getGeoLocation().getLongitude(),</span>
<span class="nc" id="L489">                    p2.getValue().get(i+1).getGeoLocation().getLongitude(), p2.getValue().get(i).getGeoLocation().getElevation(),</span>
<span class="nc" id="L490">                    p2.getValue().get(i+1).getGeoLocation().getElevation());</span>
                    }
                    
<span class="nc bnc" id="L493" title="All 2 branches missed.">                    if (distance1 &gt; distance2) {</span>
<span class="nc" id="L494">                        return 1;</span>
<span class="nc bnc" id="L495" title="All 2 branches missed.">                    } else if (distance1 &lt; distance2) {</span>
<span class="nc" id="L496">                        return -1;</span>
                    }
<span class="nc" id="L498">                    return 0;</span>
                });
            }
<span class="nc bnc" id="L501" title="All 2 branches missed.">            else if(sortingCriteria.equalsIgnoreCase(&quot;number_of_points&quot;)){</span>
<span class="nc" id="L502">                Collections.sort(pathsPassingThroughPoints, (final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p1, final Pair&lt;Double, List&lt;PointInterest&gt;&gt; p2) -&gt; {</span>
<span class="nc bnc" id="L503" title="All 2 branches missed.">                    if (p1.getValue().size() &gt; p2.getValue().size()) {</span>
<span class="nc" id="L504">                        return 1;</span>
<span class="nc bnc" id="L505" title="All 2 branches missed.">                    } else if (p1.getValue().size() &lt; p2.getValue().size()) {</span>
<span class="nc" id="L506">                        return -1;</span>
                    }
<span class="nc" id="L508">                    return 0;</span>
                });
            }

<span class="nc bnc" id="L512" title="All 2 branches missed.">            if (!ascendingOrder) {</span>
<span class="nc" id="L513">                Collections.reverse(pathsPassingThroughPoints);</span>
            }

<span class="nc bnc" id="L516" title="All 4 branches missed.">            if (numRoutes &gt;= 0 &amp;&amp; numRoutes &lt; pathsPassingThroughPoints.size()) {</span>
<span class="nc" id="L517">                pathsPassingThroughPoints.subList(numRoutes, pathsPassingThroughPoints.size()).clear();</span>
            }

<span class="nc" id="L520">            return pathsPassingThroughPoints;</span>
        }

    }

    /**
     *
     * @param park1
     * @param park2
     * @param user
     * @return
     * @throws SQLException
     */
    public List&lt;Scooter&gt; getScootersWith10PercentageExtra(Park park1, Park park2, User user) throws SQLException {
<span class="nc" id="L534">        List&lt;Scooter&gt; lstScooter = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L535">        List&lt;PointInterest&gt; listPois = new ArrayList&lt;&gt;();</span>
        //listPois = this.shortestRoute(park1, park2).getValue();
<span class="nc" id="L537">        List&lt;Scooter&gt; allScooter = new VehicleDataHandler().getScootersOfPark(listPois.get(0).getIdPoint());</span>
<span class="nc bnc" id="L538" title="All 2 branches missed.">        for (Scooter scooter : allScooter) {</span>
<span class="nc" id="L539">            double neededEnergy = 0;</span>
<span class="nc bnc" id="L540" title="All 2 branches missed.">            for(int i = 0; i &lt; listPois.size() -1; i++){</span>

<span class="nc" id="L542">                Path path = new ParkDataHandler().getPathByIdParks(i, i+1);</span>

<span class="nc" id="L544">                neededEnergy += new PhysicsAlgorithms().calculateEnergyforGivenTrip(scooter.getWeight(),</span>
<span class="nc" id="L545">                        user.getWeight(), path.getKineticCoefficient(), scooter.getFrontalArea(),</span>
<span class="nc" id="L546">                        scooter.getAerodynamicCoefficient(), path.getWindSpeed(),</span>
<span class="nc" id="L547">                        path.getWindDirection(), listPois.get(i).getGeoLocation().getElevation(), listPois.get(i+1).getGeoLocation().getElevation(),</span>
<span class="nc" id="L548">                        listPois.get(i).getGeoLocation().getLatitude(), listPois.get(i+1).getGeoLocation().getLatitude(), listPois.get(i).getGeoLocation().getLongitude(),</span>
<span class="nc" id="L549">                        listPois.get(i+1).getGeoLocation().getLongitude());</span>
            }
            
<span class="nc" id="L552">            double actualEnergy = (double) ((scooter.getActualBatteryCapacity() * scooter.getMaxBatteryCapacity())/100)* 3600000;//J</span>
<span class="nc bnc" id="L553" title="All 2 branches missed.">            if (actualEnergy &gt;= neededEnergy) {</span>
<span class="nc" id="L554">                lstScooter.add(scooter);</span>
            }
<span class="nc" id="L556">        }</span>
        
<span class="nc" id="L558">        return lstScooter;</span>
    }

    /**
     *
     * @param idPark
     * @return
     */
    public List&lt;Scooter&gt; getScootersWithMoreEnergy(int idPark){

<span class="nc" id="L568">        String query = &quot;SELECT * FROM vehicle v INNER JOIN  scooter s ON v.id_vehicle = s.id_scooter&quot;</span>
                + &quot; WHERE v.vehicle_state = 1 AND v.id_park = &quot; + idPark + &quot; ORDER BY s.actual_batery_capacity DESC&quot;;
<span class="nc" id="L570">        ArrayList&lt;Scooter&gt; lstScooter = new ArrayList&lt;&gt;();</span>

<span class="nc" id="L572">        Statement stm = null;</span>
<span class="nc" id="L573">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L576">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L577">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L579" title="All 2 branches missed.">            while (rst.next()) {</span>
<span class="nc" id="L580">                int idVehicle = rst.getInt(1);</span>
<span class="nc" id="L581">                String description = rst.getString(4);</span>
<span class="nc" id="L582">                int state = rst.getInt(5);</span>
<span class="nc" id="L583">                float weight = rst.getFloat(6);</span>
<span class="nc" id="L584">                float aerodynamicCoefficient = rst.getFloat(7);</span>
<span class="nc" id="L585">                float frontalArea = rst.getFloat(8);</span>
<span class="nc" id="L586">                int type = rst.getInt(10);</span>
<span class="nc" id="L587">                int maxBateryCapacity = rst.getInt(11);</span>
<span class="nc" id="L588">                int actualBateryCapacity = rst.getInt(12);</span>
<span class="nc" id="L589">                int motor = rst.getInt(13);</span>

<span class="nc" id="L591">                Scooter scooter = new Scooter(type, maxBateryCapacity, actualBateryCapacity, motor, idVehicle, state, description, weight, aerodynamicCoefficient, frontalArea);</span>
<span class="nc" id="L592">                lstScooter.add(scooter);</span>
<span class="nc" id="L593">            }</span>
<span class="nc" id="L594">        } catch (SQLException e) {</span>
<span class="nc" id="L595">            Logger.getLogger(RentalDataHandler.class.getName()).log(Level.WARNING, e.getMessage());</span>
        } finally {
            try{
<span class="nc bnc" id="L598" title="All 2 branches missed.">            if (rst != null) {</span>
<span class="nc" id="L599">                rst.close();</span>
            }
<span class="nc bnc" id="L601" title="All 2 branches missed.">            if (stm != null) {</span>
<span class="nc" id="L602">                stm.close();</span>
            }
<span class="nc" id="L604">            }catch(SQLException ex){</span>
<span class="nc" id="L605">                Logger.getLogger(RentalDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L606">            }</span>
        }
<span class="nc" id="L608">        return lstScooter;</span>
    }

    public int makeRental(int idUser, int idVehicle) throws SQLException {
<span class="nc" id="L612">        CallableStatement callStmt = null;</span>

<span class="nc" id="L614">        int id = 0;</span>

<span class="nc" id="L616">        callStmt = dataHandler.getConnection().prepareCall(&quot;{? = call funcMakeRental(?,?) }&quot;);</span>
<span class="nc" id="L617">        callStmt.registerOutParameter(1, OracleTypes.INTEGER);</span>
<span class="nc" id="L618">        callStmt.setInt(2,idVehicle);</span>
<span class="nc" id="L619">        callStmt.setInt(3,idUser);</span>
<span class="nc" id="L620">        callStmt.execute();</span>

<span class="nc" id="L622">        id = callStmt.getInt(1);</span>

        try {

<span class="nc" id="L626">            callStmt.close();</span>

<span class="nc" id="L628">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L629">            Logger.getLogger(RentalDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L630">        }</span>
<span class="nc" id="L631">        return id;</span>
    }
    
    public List&lt;Rental&gt; getUnfinishedTrips(){
<span class="nc" id="L635">        String query = &quot;SELECT * FROM rental WHERE (rental_begin_date_hour IS NOT NULL &quot;</span>
                + &quot;AND rental_end_date_hour IS NULL&quot;;

<span class="nc" id="L638">        Statement stm = null;</span>
<span class="nc" id="L639">        ResultSet rst = null;</span>
<span class="nc" id="L640">        ArrayList&lt;Rental&gt; unfinishedTrips = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L641">        VehicleDataHandler vehicleDataHandler = new VehicleDataHandler();</span>
<span class="nc" id="L642">        ParkDataHandler parkDataHandler = new ParkDataHandler();</span>
<span class="nc" id="L643">        UserDataHandler userDataHandler = new UserDataHandler();</span>
                
        try {
<span class="nc" id="L646">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L647">            rst = stm.executeQuery(query);</span>
<span class="nc" id="L648">            SimpleDateFormat simpleDate = new SimpleDateFormat(&quot;dd/mm/yyyy HH:mm:ss&quot;);</span>
            

<span class="nc bnc" id="L651" title="All 2 branches missed.">            while (rst.next()) {</span>
<span class="nc" id="L652">                Park parkPicking = parkDataHandler.getById(rst.getInt(2));</span>
<span class="nc" id="L653">                Vehicle vehicle = vehicleDataHandler.getById(rst.getInt(4));</span>
<span class="nc" id="L654">                User user = userDataHandler.getById(rst.getInt(5));</span>
<span class="nc" id="L655">                String beginDateHour = simpleDate.format(rst.getDate(7));</span>
<span class="nc" id="L656">                Rental rental = new Rental(user, vehicle, parkPicking);</span>
<span class="nc" id="L657">                rental.setBeginDateHour(beginDateHour); </span>
<span class="nc" id="L658">                unfinishedTrips.add(rental);</span>
<span class="nc" id="L659">            }</span>
<span class="nc" id="L660">        } catch (SQLException e) {</span>
<span class="nc" id="L661">            Logger.getLogger(UserDataHandler.class.getName()).log(Level.WARNING, e.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L664" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L665">                    rst.close();</span>
                }
<span class="nc bnc" id="L667" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L668">                    stm.close();</span>
                }
<span class="nc" id="L670">            } catch (SQLException ex) {</span>
<span class="nc" id="L671">                Logger.getLogger(UserDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L672">            }</span>
        }
<span class="nc" id="L674">        return unfinishedTrips;</span>
    }
    
    public Rental getRentalById(int idRental) {
<span class="nc" id="L678">        UserDataHandler uc = new UserDataHandler();</span>
<span class="nc" id="L679">        ParkDataHandler pc = new ParkDataHandler();</span>
<span class="nc" id="L680">        VehicleDataHandler vc = new VehicleDataHandler();</span>
        
<span class="nc" id="L682">        String query = &quot;SELECT * FROM rental &quot;</span>
                + &quot; WHERE id_rental = &quot; + idRental;

<span class="nc" id="L685">        Statement stm = null;</span>
<span class="nc" id="L686">        ResultSet rst = null;</span>
        try {
<span class="nc" id="L688">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L689">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L691" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L692">                int parkOriginID = rst.getInt(2);</span>
<span class="nc" id="L693">                int parkDestinationID = rst.getInt(3);</span>
<span class="nc" id="L694">                int vehicleID = rst.getInt(4);</span>
<span class="nc" id="L695">                int userID = rst.getInt(5);</span>
<span class="nc" id="L696">                int cost = rst.getInt(6);</span>
<span class="nc" id="L697">                long beginHour = rst.getDate(7).getTime();</span>
<span class="nc" id="L698">                long endHour = rst.getDate(8).getTime();</span>
<span class="nc" id="L699">                int duration = rst.getInt(9);</span>
<span class="nc" id="L700">                int earnedPoints = rst.getInt(10);</span>
                
<span class="nc" id="L702">                Rental rental = new Rental(uc.getById(userID), vc.getById(vehicleID), pc.getById(parkOriginID));</span>
<span class="nc" id="L703">                rental.setParkTo(pc.getById(parkDestinationID));</span>
<span class="nc" id="L704">                rental.setIdRental(idRental);</span>
<span class="nc" id="L705">                rental.setCost(cost);</span>
<span class="nc" id="L706">                rental.setBeginDateHour(String.valueOf(beginHour));</span>
<span class="nc" id="L707">                rental.setEndDateHour(String.valueOf(endHour));</span>
<span class="nc" id="L708">                rental.setDuration(duration);</span>
<span class="nc" id="L709">                rental.setEarnedPoints(earnedPoints);</span>
<span class="nc" id="L710">                return rental;</span>
            }
<span class="nc" id="L712">        } catch (SQLException ex) {</span>
<span class="nc" id="L713">            Logger.getLogger(VehicleDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L716" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L717">                    rst.close();</span>
                }
<span class="nc bnc" id="L719" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L720">                    stm.close();</span>
                }
<span class="nc" id="L722">            } catch (SQLException ex) {</span>
<span class="nc" id="L723">                Logger.getLogger(VehicleDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L724">            }</span>
        }
<span class="nc" id="L726">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>