<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pt"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ParkDataHandler.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">ride-sharing</a> &gt; <a href="index.source.html" class="el_package">lapr.project.data</a> &gt; <span class="el_source">ParkDataHandler.java</span></div><h1>ParkDataHandler.java</h1><pre class="source lang-java linenums">/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package lapr.project.data;

import java.sql.CallableStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.Collections;
import java.util.LinkedList;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javafx.util.Pair;
import lapr.project.model.GeographicalLocation;
import lapr.project.model.Park;
import lapr.project.model.Path;
import lapr.project.model.PointInterest;
import lapr.project.model.Scooter;
import lapr.project.utils.PhysicsAlgorithms;
import oracle.jdbc.OracleTypes;

/**
 *
 * @author TiagoRibeiro
 */
public class ParkDataHandler {

<span class="fc" id="L33">    private static final Logger WARNING_LOGGER_PARK = Logger.getLogger(Park.class.getName());</span>

    private final DataHandler dataHandler;

<span class="nc" id="L37">    public ParkDataHandler() {</span>
<span class="nc" id="L38">        dataHandler = DataHandler.getInstance();</span>
<span class="nc" id="L39">    }</span>

    public static void warningError() {
<span class="nc" id="L42">        WARNING_LOGGER_PARK.log(Level.WARNING, &quot;Error on reading Database.&quot;);</span>
<span class="nc" id="L43">    }</span>

    /**
     * 
     * @param element
     * @return
     * @throws SQLException 
     */
    public int addPark(Park element) throws SQLException {
<span class="nc" id="L52">        CallableStatement callStmt = null;</span>
<span class="nc" id="L53">        int id = 0;</span>

<span class="nc" id="L55">        callStmt = dataHandler.getConnection().prepareCall(&quot;{? = call funcAddPark(?,?,?,?,?,?,?,?,?,?) }&quot;);</span>
<span class="nc" id="L56">        callStmt.registerOutParameter(1, OracleTypes.INTEGER);</span>
<span class="nc" id="L57">        callStmt.setString(2, element.getRefPark());</span>
<span class="nc" id="L58">        callStmt.setString(3, element.getDescription());</span>
<span class="nc" id="L59">        callStmt.setDouble(4, element.getGeoLocation().getLatitude());</span>
<span class="nc" id="L60">        callStmt.setDouble(5, element.getGeoLocation().getLongitude());</span>
<span class="nc" id="L61">        callStmt.setInt(6, element.isState());</span>
<span class="nc" id="L62">        callStmt.setDouble(7, element.getParkInputVoltage());</span>
<span class="nc" id="L63">        callStmt.setDouble(8, element.getParkInputCurrent());</span>
<span class="nc" id="L64">        callStmt.setDouble(9, element.getGeoLocation().getElevation());</span>
<span class="nc" id="L65">        callStmt.setInt(10, element.getCapacity().get(0).getCapacityMax());</span>
<span class="nc" id="L66">        callStmt.setInt(11, element.getCapacity().get(1).getCapacityMax());</span>

<span class="nc" id="L68">        callStmt.execute();</span>

<span class="nc" id="L70">        id = callStmt.getInt(1);</span>
        try {
<span class="nc" id="L72">            callStmt.close();</span>
<span class="nc" id="L73">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L74">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L75">        }</span>

<span class="nc" id="L77">        return id;</span>
    }

    /**
     * 
     * @param id
     * @return 
     */
    public Park getById(int id) {
<span class="nc" id="L86">        String query = &quot;SELECT * &quot;</span>
                + &quot;FROM point_interest poi INNER JOIN park p ON poi.id_point =&quot; + id
                + &quot;WHERE poi.id_point = p.id_park&quot;;
<span class="nc" id="L89">        Statement stm = null;</span>
<span class="nc" id="L90">        ResultSet rst = null;</span>

        try {

<span class="nc" id="L94">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L95">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">            if (rst.next()) {</span>

<span class="nc" id="L99">                String description = rst.getString(2);</span>
<span class="nc" id="L100">                double latitude = rst.getDouble(3);</span>
<span class="nc" id="L101">                double longitude = rst.getDouble(4);</span>
<span class="nc" id="L102">                double elevation = rst.getDouble(5);</span>
<span class="nc" id="L103">                String refPark = rst.getString(7);</span>
<span class="nc" id="L104">                int state = rst.getInt(8);</span>
<span class="nc" id="L105">                int parkInputVoltage = rst.getInt(9);</span>
<span class="nc" id="L106">                int parkInputCurrent = rst.getInt(10);</span>

<span class="nc" id="L108">                return new Park(id, refPark, description, state, parkInputVoltage, parkInputCurrent, new GeographicalLocation(latitude, longitude, elevation));</span>
            }
<span class="nc" id="L110">        } catch (SQLException ex) {</span>
<span class="nc" id="L111">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L114" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L115">                    rst.close();</span>
                }
<span class="nc bnc" id="L117" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L118">                    stm.close();</span>
                }
<span class="nc" id="L120">            } catch (SQLException ex) {</span>
<span class="nc" id="L121">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L122">            }</span>
        }
<span class="nc" id="L124">        return null;</span>
    }

    /**
     * Method used to remove (change state of park to unavailable (0)) a park
     * from table PARK
     *
     * @param idPark id of the park that will be removed.
     * @return
     * @throws java.sql.SQLException
     */
    public boolean removePark(int idPark) throws SQLException {
<span class="nc" id="L136">        CallableStatement callV = null;</span>
<span class="nc" id="L137">        boolean removed = false;</span>

<span class="nc" id="L139">        callV = dataHandler.getConnection().prepareCall(&quot;{ call procRemovePark(?) }&quot;);</span>

<span class="nc" id="L141">        callV.setInt(1, idPark);</span>

<span class="nc" id="L143">        callV.execute();</span>

<span class="nc" id="L145">        removed = true;</span>

        try {
<span class="nc" id="L148">            callV.close();</span>
<span class="nc" id="L149">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L150">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L151">        }</span>

<span class="nc" id="L153">        return removed;</span>
    }

    /**
     * 
     * @param latitude
     * @param longitude
     * @param radius
     * @return 
     */
    public List&lt;Pair&lt;Double, Park&gt;&gt; getNearestParks(double latitude, double longitude, double radius) {

<span class="nc" id="L165">        List&lt;Park&gt; parksList = this.getAllParks();</span>

<span class="nc" id="L167">        List&lt;Pair&lt;Double, Park&gt;&gt; nearestParks = new ArrayList&lt;&gt;();</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        for (Park p : parksList) {</span>
<span class="nc" id="L169">            double distance = new PhysicsAlgorithms().linearDistanceTo(latitude, p.getGeoLocation().getLatitude(), longitude, p.getGeoLocation().getLongitude());</span>
<span class="nc bnc" id="L170" title="All 2 branches missed.">            if (radius &lt;= 0) {</span>
<span class="nc" id="L171">                radius = 1000;</span>
            }
<span class="nc bnc" id="L173" title="All 2 branches missed.">            if (distance &lt;= radius) {</span>
<span class="nc" id="L174">                Pair&lt;Double, Park&gt; pair = new Pair(distance, p);</span>
<span class="nc" id="L175">                nearestParks.add(pair);</span>
            }
<span class="nc" id="L177">        }</span>
<span class="nc" id="L178">        Collections.sort(nearestParks, (final Pair&lt;Double, Park&gt; p1, final Pair&lt;Double, Park&gt; p2) -&gt; {</span>
<span class="nc bnc" id="L179" title="All 2 branches missed.">            if (p1.getKey() &gt; p2.getKey()) {</span>
<span class="nc" id="L180">                return 1;</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">            } else if (p1.getKey() &lt; p2.getKey()) {</span>
<span class="nc" id="L182">                return -1;</span>
            }
<span class="nc" id="L184">            return 0;</span>
        });

<span class="nc" id="L187">        return nearestParks;</span>
    }

    /**
     * @return list of all parks in the Database
     */
    public List&lt;Park&gt; getAllParks() {
<span class="nc" id="L194">        ArrayList&lt;Park&gt; parkList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L195">        String query = &quot;SELECT * FROM park p INNER JOIN point_interest poi ON p.id_park = poi.id_point &quot;</span>
                + &quot;WHERE park_state = 1&quot;;

<span class="nc" id="L198">        Statement stm = null;</span>
<span class="nc" id="L199">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L202">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L203">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L205" title="All 2 branches missed.">            while (rst.next()) {</span>
<span class="nc" id="L206">                int parkId = rst.getInt(1);</span>
<span class="nc" id="L207">                String refPark = rst.getString(2);</span>
<span class="nc" id="L208">                String description = rst.getString(7);</span>
<span class="nc" id="L209">                double latitude = rst.getDouble(8);</span>
<span class="nc" id="L210">                double longitude = rst.getDouble(9);</span>
<span class="nc" id="L211">                int state = rst.getInt(3);</span>
<span class="nc" id="L212">                int parkInputVoltage = rst.getInt(4);</span>
<span class="nc" id="L213">                int parkInputCurrent = rst.getInt(5);</span>
<span class="nc" id="L214">                double elevation = rst.getDouble(10);</span>
<span class="nc bnc" id="L215" title="All 2 branches missed.">                if (state != 0) {</span>
<span class="nc" id="L216">                    parkList.add(new Park(parkId, refPark, description, state, parkInputVoltage, parkInputCurrent, new GeographicalLocation(latitude, longitude, elevation)));</span>
                }
<span class="nc" id="L218">            }</span>
<span class="nc" id="L219">            return parkList;</span>
<span class="nc" id="L220">        } catch (SQLException ex) {</span>
<span class="nc" id="L221">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L224" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L225">                    rst.close();</span>
                }
<span class="nc bnc" id="L227" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L228">                    stm.close();</span>
                }
<span class="nc" id="L230">            } catch (SQLException ex) {</span>
<span class="nc" id="L231">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L232">            }</span>
        }
<span class="nc" id="L234">        return parkList;</span>
    }

    /**
     * @return list of all points of interest in the Database
     * @throws SQLException
     */
    public List&lt;PointInterest&gt; getAllPointsOfInterest() {
<span class="nc" id="L242">        ArrayList&lt;PointInterest&gt; poiList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L243">        String query = &quot;SELECT * FROM point_interest&quot;;</span>

<span class="nc" id="L245">        Statement stm = null;</span>
<span class="nc" id="L246">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L249">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L250">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L252" title="All 2 branches missed.">            while (rst.next()) {</span>
<span class="nc" id="L253">                int poiId = rst.getInt(1);</span>
<span class="nc" id="L254">                String description = rst.getString(2);</span>
<span class="nc" id="L255">                double latitude = rst.getDouble(3);</span>
<span class="nc" id="L256">                double longitude = rst.getDouble(4);</span>
<span class="nc" id="L257">                double elevation = rst.getDouble(5);</span>

<span class="nc" id="L259">                poiList.add(new PointInterest(poiId, new GeographicalLocation(latitude, longitude, elevation), description));</span>
<span class="nc" id="L260">            }</span>
<span class="nc" id="L261">            return poiList;</span>
<span class="nc" id="L262">        } catch (SQLException ex) {</span>
<span class="nc" id="L263">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L266" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L267">                    rst.close();</span>
                }
<span class="nc bnc" id="L269" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L270">                    stm.close();</span>
                }
<span class="nc" id="L272">            } catch (SQLException ex) {</span>
<span class="nc" id="L273">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L274">            }</span>
        }
<span class="nc" id="L276">        return poiList;</span>
    }

    /**
     * @return list of all paths in the Database
     * @throws SQLException
     */
    public List&lt;Path&gt; getAllPaths() {
<span class="nc" id="L284">        ArrayList&lt;Path&gt; pathsList = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L285">        String query = &quot;SELECT * FROM available_paths&quot;;</span>

<span class="nc" id="L287">        Statement stm = null;</span>
<span class="nc" id="L288">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L291">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L292">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L294" title="All 2 branches missed.">            while (rst.next()) {</span>
<span class="nc" id="L295">                int idPointFrom = rst.getInt(1);</span>
<span class="nc" id="L296">                int idPointTo = rst.getInt(2);</span>
<span class="nc" id="L297">                double kineticCoefficient = rst.getDouble(3);</span>
<span class="nc" id="L298">                float windDirection = rst.getFloat(4);</span>
<span class="nc" id="L299">                float windSpeed = rst.getFloat(5);</span>

<span class="nc" id="L301">                PointInterest pointFrom = this.getPoiById(idPointFrom);</span>
<span class="nc" id="L302">                PointInterest pointTo = this.getPoiById(idPointTo);</span>

<span class="nc" id="L304">                pathsList.add(new Path(pointFrom, pointTo, kineticCoefficient, windDirection, windSpeed));</span>
<span class="nc" id="L305">            }</span>
<span class="nc" id="L306">            return pathsList;</span>
<span class="nc" id="L307">        } catch (SQLException ex) {</span>
<span class="nc" id="L308">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L311" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L312">                    rst.close();</span>
                }
<span class="nc bnc" id="L314" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L315">                    stm.close();</span>
                }
<span class="nc" id="L317">            } catch (SQLException ex) {</span>
<span class="nc" id="L318">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L319">            }</span>
        }
<span class="nc" id="L321">        return pathsList;</span>
    }

    /**
     * 
     * @param parkId
     * @param userId
     * @return 
     */
    public int checkParkFreeSpots(int parkId, int userId) {
<span class="nc" id="L331">        int spacesAvailable = 0;</span>
<span class="nc" id="L332">        String query = &quot;SELECT availability_vehicle\n&quot;</span>
                + &quot;FROM park_capacity pc\n&quot;
                + &quot;WHERE pc.id_vehicle_type =(\n&quot;
                + &quot;    SELECT v.id_vehicle_type\n&quot;
                + &quot;    FROM vehicle v INNER JOIN rental r ON v.id_vehicle = r.id_vehicle\n&quot;
                + &quot;    WHERE r.id_user = &quot; + userId + &quot; AND r.rental_end_date_hour IS NULL) &quot;
                + &quot;  AND pc.id_park = &quot; + parkId;
<span class="nc" id="L339">        Statement stm = null;</span>
<span class="nc" id="L340">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L343">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L344">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L346" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L347">                spacesAvailable = rst.getInt(1);</span>
            }

<span class="nc" id="L350">            return spacesAvailable;</span>
<span class="nc" id="L351">        } catch (SQLException ex) {</span>
<span class="nc" id="L352">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L355" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L356">                    rst.close();</span>
                }
<span class="nc bnc" id="L358" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L359">                    stm.close();</span>
                }
<span class="nc" id="L361">            } catch (SQLException ex) {</span>
<span class="nc" id="L362">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L363">            }</span>
        }
<span class="nc" id="L365">        return spacesAvailable;</span>
    }

    /**
     * 
     * @param parkId
     * @param userId
     * @return
     * @throws SQLException 
     */
    public boolean parkVehicle(int parkId, int userId) throws SQLException {
<span class="nc" id="L376">        CallableStatement callV = null;</span>
<span class="nc" id="L377">        boolean actionSucessful = false;</span>

<span class="nc" id="L379">        callV = dataHandler.getConnection().prepareCall(&quot;{ call procParkVehicle(?, ?) }&quot;);</span>
<span class="nc" id="L380">        callV.setInt(1, parkId);</span>
<span class="nc" id="L381">        callV.setInt(2, userId);</span>
<span class="nc" id="L382">        callV.execute();</span>
<span class="nc" id="L383">        actionSucessful = true;</span>

        try {

<span class="nc" id="L387">            callV.close();</span>

<span class="nc" id="L389">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L390">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>

<span class="nc" id="L392">        }</span>

<span class="nc" id="L394">        return actionSucessful;</span>
    }

    /**
     * Addition of the POI to Database
     *
     * @param poi Point of Interest to be added
     * @return POI unique ID on database
     * @throws SQLException
     */
    public int addPOI(PointInterest poi) throws SQLException {
<span class="nc" id="L405">        CallableStatement callStmt = null;</span>

<span class="nc" id="L407">        int id = 0;</span>
<span class="nc" id="L408">        callStmt = dataHandler.getConnection().prepareCall(&quot;{? = call funcAddPoi(?,?,?,?) }&quot;);</span>
<span class="nc" id="L409">        callStmt.registerOutParameter(1, OracleTypes.INTEGER);</span>
<span class="nc" id="L410">        callStmt.setDouble(2, poi.getGeoLocation().getLatitude());</span>
<span class="nc" id="L411">        callStmt.setDouble(3, poi.getGeoLocation().getLongitude());</span>
<span class="nc" id="L412">        callStmt.setDouble(4, poi.getGeoLocation().getElevation());</span>
<span class="nc" id="L413">        callStmt.setString(5, poi.getDescription());</span>
<span class="nc" id="L414">        callStmt.execute();</span>

<span class="nc" id="L416">        id = callStmt.getInt(1);</span>

        try {

<span class="nc" id="L420">            callStmt.close();</span>

<span class="nc" id="L422">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L423">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>

<span class="nc" id="L425">        }</span>
<span class="nc" id="L426">        return id;</span>
    }

    /**
     * 
     * @param idPoi
     * @return 
     */
    public PointInterest getPoiById(int idPoi) {
<span class="nc" id="L435">        String query = &quot;SELECT * FROM point_interest &quot;</span>
                + &quot;WHERE id_point = &quot; + idPoi;
<span class="nc" id="L437">        Statement stm = null;</span>
<span class="nc" id="L438">        ResultSet rst = null;</span>

        try {

<span class="nc" id="L442">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L443">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L445" title="All 2 branches missed.">            if (rst.next()) {</span>

<span class="nc" id="L447">                String description = rst.getString(2);</span>
<span class="nc" id="L448">                double latitude = rst.getDouble(3);</span>
<span class="nc" id="L449">                double longitude = rst.getDouble(4);</span>
<span class="nc" id="L450">                double elevation = rst.getDouble(5);</span>

<span class="nc" id="L452">                return new PointInterest(idPoi, new GeographicalLocation(latitude, longitude, elevation), description);</span>
            }
<span class="nc" id="L454">        } catch (SQLException ex) {</span>

<span class="nc" id="L456">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L459" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L460">                    rst.close();</span>
                }
<span class="nc bnc" id="L462" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L463">                    stm.close();</span>
                }
<span class="nc" id="L465">            } catch (SQLException ex) {</span>
<span class="nc" id="L466">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L467">            }</span>
        }
<span class="nc" id="L469">        return null;</span>
    }

    /**
     * 
     * @param idPointFrom
     * @param idPointTo
     * @return 
     */
    public Path getPathByIdParks(int idPointFrom, int idPointTo) {
<span class="nc" id="L479">        String query = &quot;SELECT * FROM path_places &quot;</span>
                + &quot;WHERE id_point_from = &quot; + idPointFrom + &quot; and id_point_to = &quot; + idPointTo;
<span class="nc" id="L481">        Statement stm = null;</span>
<span class="nc" id="L482">        ResultSet rst = null;</span>

        try {

<span class="nc" id="L486">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L487">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L489" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L490">                PointInterest pointFrom = this.getPoiById(idPointFrom);</span>
<span class="nc" id="L491">                PointInterest pointTo = this.getPoiById(idPointTo);</span>
<span class="nc" id="L492">                double kineticCoefficient = rst.getDouble(3);</span>
<span class="nc" id="L493">                float windDirection = rst.getFloat(4);</span>
<span class="nc" id="L494">                float windSpeed = rst.getFloat(5);</span>

<span class="nc" id="L496">                return new Path(pointFrom, pointTo, kineticCoefficient, windDirection, windSpeed);</span>
            }
<span class="nc" id="L498">        } catch (SQLException ex) {</span>

<span class="nc" id="L500">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L503" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L504">                    rst.close();</span>
                }
<span class="nc bnc" id="L506" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L507">                    stm.close();</span>
                }
<span class="nc" id="L509">            } catch (SQLException ex) {</span>
<span class="nc" id="L510">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L511">            }</span>
        }
<span class="nc" id="L513">        return null;</span>
    }

    /**
     * Updates information on a determined Park
     *
     * @param idPark ID of the Park that will have its attributes altered
     * @param description new park description
     * @return true or false on wether the park was properly updated or not
     * @throws SQLException
     */
    public boolean updatePark(int idPark, String description) throws SQLException {
<span class="nc" id="L525">        CallableStatement callV = null;</span>
<span class="nc" id="L526">        boolean removed = false;</span>

<span class="nc" id="L528">        callV = dataHandler.getConnection().prepareCall(&quot;{ call procUpdatePark(?,?) }&quot;);</span>

<span class="nc" id="L530">        callV.setInt(1, idPark);</span>
<span class="nc" id="L531">        callV.setString(2, description);</span>

<span class="nc" id="L533">        callV.execute();</span>

<span class="nc" id="L535">        removed = true;</span>

        try {
<span class="nc" id="L538">            callV.close();</span>
<span class="nc" id="L539">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L540">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L541">        }</span>

<span class="nc" id="L543">        return removed;</span>
    }

    /**
     * 
     * @param latitude
     * @param longitude
     * @return 
     */
    public Park getParkOfCoordinates(double latitude, double longitude) {
<span class="nc" id="L553">        String query = &quot;SELECT  p.*, poi.poi_description, poi.latitude, poi.longitude, poi.elevation&quot;</span>
                + &quot; FROM point_interest poi INNER JOIN park p &quot;
                + &quot;ON poi.id_point = p.id_park &quot;
                + &quot;WHERE latitude = &quot; + latitude + &quot; AND longitude = &quot; + longitude + &quot; AND p.park_state = 1&quot;;
<span class="nc" id="L557">        Statement stm = null;</span>
<span class="nc" id="L558">        ResultSet rst = null;</span>
<span class="nc" id="L559">        Park park = null;</span>
        try {
<span class="nc" id="L561">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L562">            rst = stm.executeQuery(query);</span>
<span class="nc bnc" id="L563" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L564">                int id = rst.getInt(1);</span>
<span class="nc" id="L565">                String refPark = rst.getString(2);</span>
<span class="nc" id="L566">                int state = rst.getInt(3);</span>
<span class="nc" id="L567">                int parkInputVoltage = rst.getInt(4);</span>
<span class="nc" id="L568">                int parkInputCurrent = rst.getInt(5);</span>
<span class="nc" id="L569">                String description = rst.getString(6);</span>
<span class="nc" id="L570">                double elevation = rst.getDouble(9);</span>

<span class="nc" id="L572">                return new Park(id, refPark, description, state, parkInputVoltage, parkInputCurrent, new GeographicalLocation(latitude, longitude, elevation));</span>
            }
<span class="nc" id="L574">        } catch (SQLException ex) {</span>
<span class="nc" id="L575">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L578" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L579">                    rst.close();</span>
                }
<span class="nc bnc" id="L581" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L582">                    stm.close();</span>
                }
<span class="nc" id="L584">            } catch (SQLException ex) {</span>
<span class="nc" id="L585">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L586">            }</span>
        }
<span class="nc" id="L588">        return park;</span>
    }

    /**
     * 
     * @param refPark
     * @return 
     */
    public Park getParkOfReference(String refPark) {
<span class="nc" id="L597">        String query = &quot;SELECT  p.*, poi.poi_description, poi.latitude, poi.longitude, poi.elevation&quot;</span>
                + &quot; FROM point_interest poi INNER JOIN park p &quot;
                + &quot;ON poi.id_point = p.id_park &quot;
                + &quot;WHERE p.ref_park LIKE '&quot; + refPark + &quot;'&quot;;
<span class="nc" id="L601">        Statement stm = null;</span>
<span class="nc" id="L602">        ResultSet rst = null;</span>
<span class="nc" id="L603">        Park park = null;</span>
        try {
<span class="nc" id="L605">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L606">            rst = stm.executeQuery(query);</span>
<span class="nc bnc" id="L607" title="All 2 branches missed.">            if (rst.next()) {</span>

<span class="nc" id="L609">                int id = rst.getInt(1);</span>
<span class="nc" id="L610">                int state = rst.getInt(3);</span>
<span class="nc" id="L611">                int parkInputVoltage = rst.getInt(4);</span>
<span class="nc" id="L612">                int parkInputCurrent = rst.getInt(5);</span>
<span class="nc" id="L613">                String description = rst.getString(6);</span>
<span class="nc" id="L614">                double latitude = rst.getDouble(7);</span>
<span class="nc" id="L615">                double longitude = rst.getDouble(8);</span>
<span class="nc" id="L616">                double elevation = rst.getDouble(9);</span>

<span class="nc" id="L618">                return new Park(id, refPark, description, state, parkInputVoltage, parkInputCurrent, new GeographicalLocation(latitude, longitude, elevation));</span>
            }
<span class="nc" id="L620">        } catch (SQLException e) {</span>
<span class="nc" id="L621">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, e.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L624" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L625">                    rst.close();</span>
                }
<span class="nc bnc" id="L627" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L628">                    stm.close();</span>
                }
<span class="nc" id="L630">            } catch (SQLException ex) {</span>
<span class="nc" id="L631">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L632">            }</span>
        }
<span class="nc" id="L634">        return park;</span>
    }

    /**
     * 
     * @param idPark
     * @return 
     */
    public LinkedList&lt;Pair&lt;Scooter, Double&gt;&gt; calculateTimeNeededToChargeTotalyByPark(int idPark) {
<span class="nc" id="L643">        VehicleDataHandler vehicleDataHandler = new VehicleDataHandler();</span>
<span class="nc" id="L644">        List&lt;Scooter&gt; scootersOfPark = vehicleDataHandler.getScootersOfPark(idPark);</span>
<span class="nc" id="L645">        Park park1 = getById(idPark);</span>
<span class="nc" id="L646">        LinkedList&lt;Pair&lt;Scooter, Double&gt;&gt; chargingStatus = new LinkedList&lt;&gt;();</span>
<span class="nc" id="L647">        int numberOfPoint = new ParkDataHandler().getTotalNumberOfScooterSpots(park1.getId()) - new ParkDataHandler().checkParkFreeScooterSpots(park1.getId());</span>
<span class="nc bnc" id="L648" title="All 2 branches missed.">        for (Scooter scooter : scootersOfPark) {</span>
<span class="nc" id="L649">            double calculateTimeNeededToChargeTotaly = new PhysicsAlgorithms().calculateTimeNeededToChargeTotaly(park1.getParkInputVoltage(), park1.getParkInputCurrent(), scooter.getActualBatteryCapacity(), scooter.getMaxBatteryCapacity(), numberOfPoint);</span>
<span class="nc" id="L650">            double maxTime = new PhysicsAlgorithms().calculateTimeNeededToChargeTotaly(park1.getParkInputVoltage(), park1.getParkInputCurrent(), 0, scooter.getMaxBatteryCapacity(), numberOfPoint);</span>
<span class="nc" id="L651">            double parkPower = park1.getParkInputCurrent() * park1.getParkInputVoltage(); //w</span>
<span class="nc" id="L652">            double pointPower = (parkPower / numberOfPoint);</span>
<span class="nc" id="L653">            int scooterActualBatery = scooter.getActualBatteryCapacity() * scooter.getMaxBatteryCapacity() / 100;</span>
<span class="nc" id="L654">            int newScooterActualBatery = ((int) ((maxTime - calculateTimeNeededToChargeTotaly) * pointPower) + scooterActualBatery) / ((int) scooter.getMaxBatteryCapacity()) * 100;</span>
<span class="nc" id="L655">            scooter.setActualBatteryCapacity(newScooterActualBatery);</span>
<span class="nc" id="L656">            chargingStatus.add(new Pair(scooter, calculateTimeNeededToChargeTotaly));</span>
<span class="nc" id="L657">        }</span>
<span class="nc" id="L658">        return chargingStatus;</span>
    }

    /**
     * 
     * @param idPark
     * @param scooterDescription
     * @return 
     */
    public Pair&lt;Scooter, Double&gt; calculateTimeNeededToChargeTotalyByScooter(int idPark, String scooterDescription) {
<span class="nc" id="L668">        VehicleDataHandler vehicleDataHandler = new VehicleDataHandler();</span>
<span class="nc" id="L669">        Park park1 = getById(idPark);</span>
<span class="nc" id="L670">        Scooter scooter = vehicleDataHandler.getScooterByDescription(scooterDescription);</span>
<span class="nc" id="L671">        Pair&lt;Scooter, Double&gt; chargingStatus = null;</span>
<span class="nc" id="L672">        int numberOfPoint = new ParkDataHandler().getTotalNumberOfScooterSpots(park1.getId()) - new ParkDataHandler().checkParkFreeScooterSpots(park1.getId());</span>
<span class="nc" id="L673">        double calculateTimeNeededToChargeTotaly = new PhysicsAlgorithms().calculateTimeNeededToChargeTotaly(park1.getParkInputVoltage(), park1.getParkInputCurrent(), scooter.getActualBatteryCapacity(), scooter.getMaxBatteryCapacity(), numberOfPoint);</span>
<span class="nc" id="L674">        double maxTime = new PhysicsAlgorithms().calculateTimeNeededToChargeTotaly(park1.getParkInputVoltage(), park1.getParkInputCurrent(), 0, scooter.getMaxBatteryCapacity(), numberOfPoint);</span>
<span class="nc" id="L675">        double parkPower = park1.getParkInputCurrent() * park1.getParkInputVoltage(); //w</span>
<span class="nc" id="L676">        double pointPower = (parkPower / numberOfPoint);</span>
<span class="nc" id="L677">        int scooterActualBatery = scooter.getActualBatteryCapacity() * scooter.getMaxBatteryCapacity() / 100;</span>
<span class="nc" id="L678">        int newScooterActualBatery = ((int) ((maxTime - calculateTimeNeededToChargeTotaly) * pointPower) + scooterActualBatery) / ((int) scooter.getMaxBatteryCapacity()) * 100;</span>
<span class="nc" id="L679">        scooter.setActualBatteryCapacity(newScooterActualBatery);</span>
<span class="nc" id="L680">        chargingStatus = new Pair(scooter, calculateTimeNeededToChargeTotaly);</span>
<span class="nc" id="L681">        return chargingStatus;</span>
    }

    /**
     * Consults the number of free scooter spots in a given park
     *
     * @param parkId id of the park
     * @return nr of free scooter spots in a given park
     * @throws SQLException
     */
    public int checkParkFreeScooterSpots(int parkId) {

<span class="nc" id="L693">        int freeScooterSpots = 0;</span>

<span class="nc" id="L695">        String query = &quot;SELECT availability_vehicle\n&quot;</span>
                + &quot;FROM park_capacity\n&quot;
                + &quot;WHERE id_vehicle_type = 2 AND id_park = &quot; + parkId;
<span class="nc" id="L698">        Statement stm = null;</span>
<span class="nc" id="L699">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L702">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L703">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L705" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L706">                freeScooterSpots = rst.getInt(1);</span>
            }

<span class="nc" id="L709">            return freeScooterSpots;</span>
<span class="nc" id="L710">        } catch (SQLException ex) {</span>
<span class="nc" id="L711">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L714" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L715">                    rst.close();</span>
                }
<span class="nc bnc" id="L717" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L718">                    stm.close();</span>
                }
<span class="nc" id="L720">            } catch (SQLException ex) {</span>
<span class="nc" id="L721">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L722">            }</span>
        }
<span class="nc" id="L724">        return freeScooterSpots;</span>
    }

    /**
     * 
     * @param parkId
     * @return 
     */
    public int getTotalNumberOfScooterSpots(int parkId) {

<span class="nc" id="L734">        int totalNumberScooterSpots = 0;</span>

<span class="nc" id="L736">        String query = &quot;SELECT capacity_vehicle\n&quot;</span>
                + &quot;FROM park_capacity\n&quot;
                + &quot;WHERE id_vehicle_type = 2 AND id_park = &quot; + parkId;
<span class="nc" id="L739">        Statement stm = null;</span>
<span class="nc" id="L740">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L743">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L744">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L746" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L747">                totalNumberScooterSpots = rst.getInt(1);</span>
            }

<span class="nc" id="L750">            return totalNumberScooterSpots;</span>
<span class="nc" id="L751">        } catch (SQLException ex) {</span>
<span class="nc" id="L752">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L755" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L756">                    rst.close();</span>
                }
<span class="nc bnc" id="L758" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L759">                    stm.close();</span>
                }
<span class="nc" id="L761">            } catch (SQLException ex) {</span>
<span class="nc" id="L762">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L763">            }</span>
        }
<span class="nc" id="L765">        return totalNumberScooterSpots;</span>
    }

    /**
     * Consults the number of free bicycle spots in a given park
     *
     * @param parkId
     * @return nr of free bicycle spots in a given park
     */
    public int checkParkFreeBicycleSpots(int parkId) {

<span class="nc" id="L776">        int freeBicycleSpots = 0;</span>
<span class="nc" id="L777">        String query = &quot;SELECT availability_vehicle\n&quot;</span>
                + &quot;FROM park_capacity\n&quot;
                + &quot;WHERE id_vehicle_type = 1 AND id_park = &quot; + parkId;
<span class="nc" id="L780">        Statement stm = null;</span>
<span class="nc" id="L781">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L784">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L785">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L787" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L788">                freeBicycleSpots = rst.getInt(1);</span>
            }

<span class="nc" id="L791">            return freeBicycleSpots;</span>
<span class="nc" id="L792">        } catch (SQLException ex) {</span>
<span class="nc" id="L793">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L796" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L797">                    rst.close();</span>
                }
<span class="nc bnc" id="L799" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L800">                    stm.close();</span>
                }
<span class="nc" id="L802">            } catch (SQLException ex) {</span>
<span class="nc" id="L803">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
<span class="nc" id="L804">            }</span>
        }
<span class="nc" id="L806">        return freeBicycleSpots;</span>
    }

    /**
     * Adds path into the system
     *
     * @param path object path
     * @return true if path is added, false if not
     * @throws SQLException
     */
    public boolean addPath(Path path) throws SQLException {
<span class="nc" id="L817">        CallableStatement callV = null;</span>
<span class="nc" id="L818">        boolean added = false;</span>

<span class="nc" id="L820">        callV = dataHandler.getConnection().prepareCall(&quot;{ call procAddPath(?,?,?,?,?) }&quot;);</span>

<span class="nc" id="L822">        callV.setInt(1, path.getPointFrom().getIdPoint());</span>
<span class="nc" id="L823">        callV.setInt(2, path.getPointTo().getIdPoint());</span>
<span class="nc" id="L824">        callV.setDouble(3, path.getKineticCoefficient());</span>
<span class="nc" id="L825">        callV.setDouble(4, path.getWindDirection());</span>
<span class="nc" id="L826">        callV.setDouble(5, path.getWindSpeed());</span>

<span class="nc" id="L828">        callV.execute();</span>

<span class="nc" id="L830">        added = true;</span>

        try {

<span class="nc" id="L834">            callV.close();</span>

<span class="nc" id="L836">        } catch (SQLException | NullPointerException ex) {</span>
<span class="nc" id="L837">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>

<span class="nc" id="L839">        }</span>
<span class="nc" id="L840">        return added;</span>
    }

    /**
     * Obtains a PointInterest by it's latitude and longitude
     *
     * @param pointLatitude latitude
     * @param pointLongitude longitude
     * @return the PointInterest object with the parameter coordinates
     */
    public PointInterest getPointByCoordinates(double pointLatitude, double pointLongitude) {
<span class="nc" id="L851">        String query = &quot;SELECT * from point_interest &quot;</span>
                + &quot;WHERE latitude = &quot; + pointLatitude + &quot; AND longitude = &quot; + pointLongitude;

<span class="nc" id="L854">        Statement stm = null;</span>
<span class="nc" id="L855">        ResultSet rst = null;</span>

        try {

<span class="nc" id="L859">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L860">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L862" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L863">                int idPoint = rst.getInt(1);</span>
<span class="nc" id="L864">                String description = rst.getString(2);</span>
<span class="nc" id="L865">                double latitude = rst.getDouble(3);</span>
<span class="nc" id="L866">                double longitude = rst.getDouble(4);</span>
<span class="nc" id="L867">                double elevation = rst.getDouble(5);</span>

<span class="nc" id="L869">                return new PointInterest(idPoint, new GeographicalLocation(latitude, longitude, elevation), description);</span>
            }
<span class="nc" id="L871">        } catch (SQLException ex) {</span>
<span class="nc" id="L872">            Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, ex.getMessage());</span>
        } finally {
            try {
<span class="nc bnc" id="L875" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L876">                    rst.close();</span>
                }
<span class="nc bnc" id="L878" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L879">                    stm.close();</span>
                }
<span class="nc" id="L881">            } catch (SQLException e) {</span>
<span class="nc" id="L882">                Logger.getLogger(InvoiceDataHandler.class.getName()).log(Level.WARNING, e.getMessage());</span>
<span class="nc" id="L883">            }</span>
        }
<span class="nc" id="L885">        return null;</span>
    }

    /**
     * gets a Park that has the vehicle with the parameter ID associated
     *
     * @param vehicleId
     * @return the Park that has the vehicle of the parameter ID associated
     */
    public Park getParkByVehicleID(int vehicleId) {
<span class="nc" id="L895">        String query = &quot;SELECT p.id_park, v.id_park, poi.id_point, p.ref_park, poi.poi_description, p.park_state, p.park_input_voltage, p.park_input_current, poi.latitude, poi.longitude, poi.elevation &quot;</span>
                + &quot;FROM park p INNER JOIN vehicle v ON p.id_park = v.id_park INNER JOIN point_interest poi ON p.id_park = poi.id_point &quot;
                + &quot;WHERE v.vehicle_state = 1 AND v.id_vehicle = &quot; + vehicleId ;
<span class="nc" id="L898">        Statement stm = null;</span>
<span class="nc" id="L899">        ResultSet rst = null;</span>

        try {
<span class="nc" id="L902">            stm = dataHandler.getConnection().createStatement();</span>
<span class="nc" id="L903">            rst = stm.executeQuery(query);</span>

<span class="nc bnc" id="L905" title="All 2 branches missed.">            if (rst.next()) {</span>
<span class="nc" id="L906">                int id = rst.getInt(1);</span>
<span class="nc" id="L907">                String refPark = rst.getString(4);</span>
<span class="nc" id="L908">                String description = rst.getString(5);</span>
<span class="nc" id="L909">                int state = rst.getInt(6);</span>
<span class="nc" id="L910">                int voltage = rst.getInt(7);</span>
<span class="nc" id="L911">                int current = rst.getInt(8);</span>
<span class="nc" id="L912">                double latitude = rst.getDouble(9);</span>
<span class="nc" id="L913">                double longitude = rst.getDouble(10);</span>
<span class="nc" id="L914">                double elevation = rst.getDouble(11);</span>

<span class="nc" id="L916">                return new Park(id, refPark, description, state, voltage, current, new GeographicalLocation(latitude, longitude, elevation));</span>
            }
<span class="nc" id="L918">        } catch (SQLException ex) {</span>

<span class="nc" id="L920">            ex.printStackTrace();</span>
        } finally {
            try {
<span class="nc bnc" id="L923" title="All 2 branches missed.">                if (rst != null) {</span>
<span class="nc" id="L924">                    rst.close();</span>
                }
<span class="nc bnc" id="L926" title="All 2 branches missed.">                if (stm != null) {</span>
<span class="nc" id="L927">                    stm.close();</span>
                }
<span class="nc" id="L929">            } catch (SQLException ex) {</span>
<span class="nc" id="L930">                ex.printStackTrace();</span>
<span class="nc" id="L931">            }</span>
        }
<span class="nc" id="L933">        return null;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>